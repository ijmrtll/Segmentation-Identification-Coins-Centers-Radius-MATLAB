function newImage = runAnalysis2(Ima, im, imSet)% Gives the best solution found for each imageswitch imSet    case 1        newImage = set1(Ima, im);    case 2        newImage = set1C(Ima, im);    case 3        newImage = set2(Ima, im);    case 4        newImage = set3(Ima, im);endendfunction newImage = set1(Ima, im)switch im    case 1        newImage = not(im2bw(Ima, 0.45))|im2bw(Ima, 0.73);        newImage = imfill(imclose(newImage, strel('disk', 15, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 34, 0));    case 2        newImage = not(im2bw(Ima, 0.53))|im2bw(Ima, 0.77);        newImage = imfill(imclose(newImage, strel('disk', 6, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 35, 0));    case 3        newImage = not(im2bw(Ima, 0.71))|im2bw(Ima, 1);        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 35, 0));    case 4        newImage = not(im2bw(Ima, 0.52))|im2bw(Ima, 0.75);        newImage = imfill(imclose(newImage, strel('disk', 5, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 5, 0));    case 5        newImage = not(im2bw(Ima, 0.47))|im2bw(Ima, 0.73); %#ok<*IM2BW>        newImage = imfill(imclose(newImage, strel('disk', 6, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 35, 0));    case 6        h = fspecial('average', 5);        h = conv2(h,h);        newImage = conv2(Ima, h, 'valid');        newImage(newImage(:,:) > 255) = 255;        newImage(newImage(:,:) < 0) = 0;        newImage = uint8(newImage);        newImage = medfilt2(newImage, [15 1]);        newImage(newImage(:,:) > 255) = 255;        newImage(newImage(:,:) < 0) = 0;        newImage = uint8(newImage);        newImage = not(im2bw(newImage, 0.57))|im2bw(newImage, 0.72);        newImage = imfill(imclose(newImage, strel('disk', 6, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 35, 0));endendfunction newImage = set1C(Ima, im)switch im    case 1        ir = Ima(:,:,1);        ig = Ima(:,:,2);        ib = Ima(:,:,3);        ir = not(im2bw(ir, 0.47))|im2bw(ir, 0.75);        ig = not(im2bw(ig, 0.43))|im2bw(ig, 0.75);        ib = not(im2bw(ib, 0.45))|im2bw(ib, 0.75);        newImage = ir|ig|ib;        newImage = imfill(imclose(newImage, strel('disk', 10, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 35, 0));    case 2        ib = Ima(:,:,3);        ib = not(im2bw(ib, 0.67))|im2bw(ib, 0.88);        newImage = ib;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 3, 0));    case 3        ir = Ima(:,:,1);        ig = Ima(:,:,2);        ib = Ima(:,:,3);        ir = not(im2bw(ir, 0.7))|im2bw(ir, 0.9);        ig = not(im2bw(ig, 0.71))|im2bw(ig, 0.88);        ib = not(im2bw(ib, 0.7))|im2bw(ib, 0.87);        newImage = ir|ig|ib;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 3, 0));    case 4        ir = Ima(:,:,1);        ir = not(im2bw(ir, 0.95))|im2bw(ir, 1);        newImage = ir;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 3, 0));    case 5        ir = Ima(:,:,1);        ir = not(im2bw(ir, 0.76))|im2bw(ir, 1);        newImage = ir;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 15, 0));    case 6        h = fspecial('average', 5);        h = conv2(h,h);        newImage(:,:,1) = conv2(Ima(:,:,1), h, 'valid');        newImage(:,:,2) = conv2(Ima(:,:,2), h, 'valid');        newImage(newImage(:,:,:) > 255) = 255;        newImage(newImage(:,:,:) < 0) = 0;        newImage = uint8(newImage);        newImage(:,:,1) = medfilt2(newImage(:,:,1), [15 1]);        newImage(:,:,2) = medfilt2(newImage(:,:,2), [15 1]);        newImage(newImage(:,:,:) > 255) = 255;        newImage(newImage(:,:,:) < 0) = 0;        newImage = uint8(newImage);        ir = newImage(:,:,1);        ig = newImage(:,:,2);        ir = not(im2bw(ir, 0.65))|im2bw(ir, 0.86); %0.63 - 0.88 without median filter        ig = not(im2bw(ig, 0.55))|im2bw(ig, 0.73); %0.5 - 0.80 without median filter        newImage = ir|ig;        newImage = imfill(imclose(newImage, strel('disk', 5, 0)), 'hole'); %6 without median filter        newImage = imopen(newImage,strel('disk', 25, 0)); %16 without median filterendendfunction newImage = set2(Ima, im)switch im    case 1        ir = Ima(:,:,1);        ig = Ima(:,:,2);        ib = Ima(:,:,3);        ir = not(im2bw(ir, 0.61))|im2bw(ir, 1);        ig = not(im2bw(ig, 0.5))|im2bw(ig, 1);        ib = not(im2bw(ib, 0.71))|im2bw(ib, 0.9);        newImage = (ir&ib)&ig;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 35, 0));    case 2        ir = Ima(:,:,1);        %ig = Ima(:,:,2);        ib = Ima(:,:,3);        ir = not(im2bw(ir, 0.95))|im2bw(ir, 1);        ib = not(im2bw(ib, 0.54))|im2bw(ib, 1);        newImage = ir&ib;        newImage = imfill(imclose(newImage, strel('disk', 4, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 40, 0));    case 3        %ir = Ima(:,:,1);        %ig = Ima(:,:,2);        %ib = Ima(:,:,3);        %ir = not(im2bw(ir, 0.44))|im2bw(ir, 0.9);        %ig = not(im2bw(ig, 0.81))|im2bw(ig, 1);        %ib = not(im2bw(ib, 0.43))|im2bw(ib, 0.75);        %newImage = (ir|ib)&ig;        %newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        %newImage = imopen(newImage,strel('disk', 3, 0));    case 4        ir = Ima(:,:,1);        ir = not(im2bw(ir, 0.95))|im2bw(ir, 1);        newImage = ir;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 3, 0));    case 5        ir = Ima(:,:,1);        ir = not(im2bw(ir, 0.76))|im2bw(ir, 1);        newImage = ir;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 15, 0));    case 6        %h = fspecial('average', 5);        %h = conv2(h,h);        %newImage(:,:,1) = conv2(Ima(:,:,1), h, 'valid');        %newImage(:,:,2) = conv2(Ima(:,:,2), h, 'valid');        %newImage(newImage(:,:,:) > 255) = 255;        %newImage(newImage(:,:,:) < 0) = 0;        %newImage = uint8(newImage);        %newImage(:,:,1) = medfilt2(newImage(:,:,1), [15 1]);        %newImage(:,:,2) = medfilt2(newImage(:,:,2), [15 1]);        %newImage(newImage(:,:,:) > 255) = 255;        %newImage(newImage(:,:,:) < 0) = 0;        %newImage = uint8(newImage);        %ir = newImage(:,:,1);        %ig = newImage(:,:,2);        %ir = not(im2bw(ir, 0.65))|im2bw(ir, 0.86); %0.63 - 0.88 without median filter        %ig = not(im2bw(ig, 0.55))|im2bw(ig, 0.73); %0.5 - 0.80 without median filter        %newImage = ir|ig;        %newImage = imfill(imclose(newImage, strel('disk', 5, 0)), 'hole'); %6 without median filter        %newImage = imopen(newImage,strel('disk', 25, 0)); %16 without median filterendendfunction newImage = set3(Ima, im)switch im    case 1        ir = Ima(:,:,1);        ig = Ima(:,:,2);        ib = Ima(:,:,3);        ir = not(im2bw(ir, 0.63))|im2bw(ir, 1);        ig = not(im2bw(ig, 0.64))|im2bw(ig, 1);        ib = not(im2bw(ib, 0.64))|im2bw(ib, 0.9);        newImage = (ir|ib)|ig;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 30, 0));    case 2        Ima = double(rgb2hsv(Ima));        is = Ima(:,:,2);        iv = Ima(:,:,3);        is = im2bw(is, 0.06);        iv = im2bw(iv, 0.72);        newImage = is|iv;        newImage = imfill(imclose(newImage, strel('disk', 2, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 15, 0));    case 3        ir = Ima(:,:,1);        ir = not(im2bw(ir, 0.9))|im2bw(ir, 1);        newImage = ir;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 30, 0));    case 4        Ima = double(rgb2hsv(Ima));        is = Ima(:,:,2);        iv = Ima(:,:,3);        is = not(im2bw(is, 0.5))|im2bw(is, 1);        iv = not(im2bw(iv, 0.6))|im2bw(iv, 1);        newImage = is|iv;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 15, 0));    case 5        h = fspecial('average', 5);        h = conv2(h,h);        newImage(:,:,1) = conv2(Ima(:,:,1), h, 'valid');        newImage(:,:,2) = conv2(Ima(:,:,2), h, 'valid');        newImage(:,:,3) = conv2(Ima(:,:,3), h, 'valid');        newImage(newImage(:,:,:) > 255) = 255;        newImage(newImage(:,:,:) < 0) = 0;        newImage = uint8(newImage);        newImage(:,:,1) = medfilt2(newImage(:,:,1), [15 1]);        newImage(:,:,2) = medfilt2(newImage(:,:,2), [15 1]);        newImage(:,:,3) = medfilt2(newImage(:,:,3), [15 1]);        newImage(newImage(:,:,:) > 255) = 255;        newImage(newImage(:,:,:) < 0) = 0;        newImage = uint8(newImage);        ir = newImage(:,:,1);        ig = newImage(:,:,2);        ir = not(im2bw(ir, 0.62))|im2bw(ir, 0.8);        ig = not(im2bw(ig, 0.52))|im2bw(ig, 0.73);        newImage = ir|ig;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 35, 0));    case 6        h = fspecial('average', 5);        h = conv2(h,h);        newImage(:,:,1) = conv2(Ima(:,:,1), h, 'valid');        newImage(:,:,2) = conv2(Ima(:,:,2), h, 'valid');        newImage(:,:,3) = conv2(Ima(:,:,3), h, 'valid');        newImage(newImage(:,:,:) > 255) = 255;        newImage(newImage(:,:,:) < 0) = 0;        newImage = uint8(newImage);        newImage(:,:,1) = medfilt2(newImage(:,:,1), [15 1]);        newImage(:,:,2) = medfilt2(newImage(:,:,2), [15 1]);        newImage(:,:,3) = medfilt2(newImage(:,:,3), [15 1]);        newImage(newImage(:,:,:) > 255) = 255;        newImage(newImage(:,:,:) < 0) = 0;        newImage = uint8(newImage);        Ima = double(rgb2hsv(newImage));        is = Ima(:,:,2);        iv = Ima(:,:,3);        is = not(im2bw(is, 0.18))|im2bw(is, 1);        iv = not(im2bw(iv, 0.45))|im2bw(iv, 1);        newImage = is|iv;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 15, 0));    case 7        Ima = double(rgb2hsv(Ima));        is = Ima(:,:,2);        iv = Ima(:,:,3);        is = not(im2bw(is, 0.46))|im2bw(is, 1);        iv = not(im2bw(iv, 0.6))|im2bw(iv, 0.87);        newImage = is|iv;        newImage = imfill(imclose(newImage, strel('disk', 2, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 33, 0));    case 8        ir = Ima(:,:,1);        ig = Ima(:,:,2);        ib = Ima(:,:,3);        ir = not(im2bw(ir, 0.53))|im2bw(ir, 1);        ig = not(im2bw(ig, 0.54))|im2bw(ig, 1);        ib = not(im2bw(ib, 0.54))|im2bw(ib, 0.9);        newImage = (ir|ib)|ig;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 30, 0));    case 9        ir = Ima(:,:,1);        ir = not(im2bw(ir, 0.89))|im2bw(ir, 1);        newImage = ir;        newImage = imfill(imclose(newImage, strel('disk', 1, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 34, 0));    case 10        Ima = double(rgb2hsv(Ima));        ih = Ima(:,:,1);        is = Ima(:,:,2);        iv = Ima(:,:,3);        ih = im2bw(ih, 0.24);        is = im2bw(is, 0.12);        iv = not(im2bw(iv, 0.46))|im2bw(iv, 0.73);        newImage = is|(ih&iv);        newImage = imfill(imclose(newImage, strel('disk', 8, 0)), 'hole');        newImage = imopen(newImage,strel('disk', 30, 0));endend